(window.webpackJsonp=window.webpackJsonp||[]).push([[255],{714:function(v,_,s){"use strict";s.r(_);var e=s(1),r=Object(e.a)({},(function(){var v=this,_=v._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[_("h3",{attrs:{id:"_1、sql语句优化"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1、sql语句优化"}},[v._v("#")]),v._v(" 1、SQL语句优化")]),v._v(" "),_("p",[v._v("1）应尽量避免在where子句中使用!=或<，>操作符，否则引擎将放弃使用索引而进行全表扫描；")]),v._v(" "),_("p",[v._v("2）应尽量避免在where子句中对字段进行null值判断，否则将导致引擎放弃索引而进行全面扫描，如：")]),v._v(" "),_("div",{staticClass:"language-sql line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-sql"}},[_("code",[v._v("Seletd id "),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("from")]),v._v(" t "),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("where")]),v._v(" num "),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("is")]),v._v(" "),_("span",{pre:!0,attrs:{class:"token boolean"}},[v._v("null")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br")])]),_("p",[v._v("可以在null上设置默认值0，确保表中num列没有null值，然后这样查询：")]),v._v(" "),_("div",{staticClass:"language-sql line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-sql"}},[_("code",[_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("Select")]),v._v(" id "),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("from")]),v._v(" t "),_("span",{pre:!0,attrs:{class:"token keyword"}},[v._v("where")]),v._v(" num"),_("span",{pre:!0,attrs:{class:"token operator"}},[v._v("=")]),_("span",{pre:!0,attrs:{class:"token number"}},[v._v("0")]),v._v("\n")])]),v._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[v._v("1")]),_("br")])]),_("p",[v._v("3）很多时候用exists代替in是一个好的选择；")]),v._v(" "),_("p",[v._v("4）用where子句替换HAVING子句，因为HAVAING只会在检索出所有记录之后才对结果集进行过滤；")]),v._v(" "),_("h3",{attrs:{id:"_2、索引优化"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2、索引优化"}},[v._v("#")]),v._v(" 2、索引优化")]),v._v(" "),_("p",[v._v("1）最左前缀匹配原则；")]),v._v(" "),_("p",[v._v("2）主键外键一定要建索引；")]),v._v(" "),_("p",[v._v("3）对较小的数据列使用索引,这样会使索引文件更小,同时内存中也可以装载更多的索引键")]),v._v(" "),_("p",[v._v("4）为较长的字符串使用前缀索引")]),v._v(" "),_("h3",{attrs:{id:"_3、数据库结构优化"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3、数据库结构优化"}},[v._v("#")]),v._v(" 3、数据库结构优化")]),v._v(" "),_("p",[v._v("1）范式优化：比如消除冗余（节省空间）")]),v._v(" "),_("p",[v._v("2）反范式优化：减少数据库连接")]),v._v(" "),_("p",[v._v("（有时会在数据冗余与范式之间做出权衡，在实际的数据开发过程中，往往会允许一部分的数据冗余来减少数据库的连接。）")]),v._v(" "),_("p",[v._v("3）拆分表：")]),v._v(" "),_("p",[v._v("分区将数据在物理上分隔开，不同的分区的数据可以指定保存于不同磁盘上的数据文件里。这样，当对这个表进行查询时，只需要在表分区中进行扫描，而不必进行全表扫描，明显缩短了查询时间，另外处于不同磁盘的分区也将对这个表的数据传输分散在不同的磁盘I/O，一个精心设计的分区可以将数据传输对磁盘I/O竞争均匀地分散开。")]),v._v(" "),_("p",[v._v("4）拆分其实又分水平拆分和垂直拆分")]),v._v(" "),_("p",[_("strong",[v._v("垂直拆分")])]),v._v(" "),_("p",[_("code",[v._v("垂直拆分就是要把表按模块划分到不同数据库表中（当然原则还是不破坏第三范式）")]),v._v(",这种拆分在大型网站的演变过程中是很常见的。当一个网站还在很小的时候，只有小量的人来开发和维护，各模块和表都在一起，当网站不断丰富和壮大的时候，也会变成多个子系统来支撑，这时就有按模块和功能把表划分出来的需求。其实，相对于垂直切分更进一步的是服务化改造，说得简单就是要把原来强耦合的系统拆分成多个弱耦合的服务，通过服务间的调用来满足业务需求看，因此表拆出来后要通过服务的形式暴露出去，而不是直接调用不同模块的表，淘宝在架构不断演变过程，最重要的一环就是服务化改造，把用户、交易、店铺、宝贝这些核心的概念抽取成独立的服务，也非常有利于进行局部的优化和治理，保障核心模块的稳定性\n垂直拆分：单表大数据量依然存在性能瓶颈")]),v._v(" "),_("p",[_("strong",[v._v("水平拆分")])]),v._v(" "),_("p",[v._v("上面谈到垂直切分只是把表按模块划分到不同数据库，但没有解决单表大数据量的问题，而水平切分就是要把一个表按照某种规则把数据划分到不同表或数据库里。例如像计费系统，通过按时间来划分表就比较合适，因为系统都是处理某一时间段的数据。而像SaaS应用，通过按用户维度来划分数据比较合适，因为用户与用户之间的隔离的，一般不存在处理多个用户数据的情况，简单的按user_id范围来水平切分")]),v._v(" "),_("p",[v._v("通俗理解："),_("code",[v._v("水平拆分行，行数据拆分到不同表中， 垂直拆分列，表数据拆分到不同表中")])]),v._v(" "),_("p",[_("strong",[v._v("垂直与水平联合切分")])]),v._v(" "),_("p",[v._v("由上面可知垂直切分能更清晰化模块划分，区分治理，水平切分能解决大数据量性能瓶颈问题，因此常常就会把两者结合使用，这在大型网站里是种常见的策略")]),v._v(" "),_("p",[v._v("案例：")]),v._v(" "),_("p",[v._v("以mysql为例，简单购物系统暂设涉及如下表：")]),v._v(" "),_("p",[v._v("1.产品表（数据量10w，稳定）")]),v._v(" "),_("p",[v._v("2.订单表（数据量200w，且有增长趋势）")]),v._v(" "),_("p",[v._v("3.用户表 （数据量100w，且有增长趋势）")]),v._v(" "),_("p",[v._v("以mysql为例讲述下水平拆分和垂直拆分，mysql能容忍的数量级在百万静态数据可以到千万")]),v._v(" "),_("ul",[_("li",[v._v("垂直拆分：")])]),v._v(" "),_("p",[v._v("解决问题：")]),v._v(" "),_("p",[v._v("表与表之间的io竞争")]),v._v(" "),_("p",[v._v("不解决问题：")]),v._v(" "),_("p",[v._v("单表中数据量增长出现的压力")]),v._v(" "),_("p",[v._v("方案：\n把产品表和用户表放到一个server上\n订单表单独放到一个server上")]),v._v(" "),_("ul",[_("li",[v._v("水平拆分：")])]),v._v(" "),_("p",[v._v("解决问题：")]),v._v(" "),_("p",[v._v("单表中数据量增长出现的压力")]),v._v(" "),_("p",[v._v("不解决问题：")]),v._v(" "),_("p",[v._v("表与表之间的io争夺")]),v._v(" "),_("p",[v._v("方案：")]),v._v(" "),_("p",[v._v("用户表通过性别拆分为男用户表和女用户表\n订单表通过已完成和完成中拆分为已完成订单和未完成订单\n产品表 未完成订单放一个server上\n已完成订单表和男用户表放一个server上\n女用户表放一个server上(女的爱购物)")]),v._v(" "),_("p",[_("img",{attrs:{src:"https://img-blog.csdnimg.cn/bb437d595a88458bbc892f93017d8d23.png",alt:"在这里插入图片描述"}})])])}),[],!1,null,null,null);_.default=r.exports}}]);